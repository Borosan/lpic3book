# 334.1 Network Hardening

#### _Topic 334: Network Security_

**Weight:** 4

**Description:** Candidates should be able to secure networks against common threats. This includes analyzing network traffic of specific nodes and protocols.



**Key Knowledge Areas:**

* Understand wireless networks security mechanisms
* Configure FreeRADIUS to authenticate network nodes
* Use Wireshark and tcpdump to analyze network traffic, including filters and statistics
* Use Kismet to analyze wireless networks and capture wireless network traffic
* Identify and deal with rogue router advertisements and DHCP messages
* Awareness of aircrack-ng and bettercap

**The following is a partial list of the used files, terms and utilities:**

* radiusd
* radmin
* radtest
* radclient
* radlast
* radwho
* radiusd.conf
* /etc/raddb/\*
* wireshark
* tshark
* tcpdump
* kismet
* ndpmon

## FreeRADIUS

### What is the RADIUS Protocol?

Remote Authentication Dial-In User Service or RADIUS is a networking protocol that offers centralized Authentication, Authorization and Accounting (**AAA**) management for users who connect and network service.

* **A**uthentication is the process of determining whether the client (user, device, or process) is a genuine user of the system.&#x20;
* **A**uthorization is the process of determining what the client is allowed to do on the network.&#x20;
* **A**ccounting is the process of monitoring the client’s activity on the network and providing the information necessary to calculate the cost for services.

You don't have to use all three of the AAA protocols, but only the ones you need. For example, you may not need accounting but only client authentication, or perhaps all you want is accounting, and client authorization is managed by something else.

It is extremely efficient and manages thousands of requests on modest hardware. Of course it works for all network protocols and not just dialup, but the name remains the same.

### FreeRADIUS

FreeRADIUS is the open source RADIUS implementation, and is the most widely-used RADIUS server.&#x20;

#### Install Freeradius&#x20;

```
[root@rocky8 ~]# dnf install  freeradius freeradius-utils freeradius-mysql freeradius-perl
```

#### **Start Freeradius Service**

<pre><code>[root@rocky8 ~]# systemctl enable radiusd --now
Created symlink /etc/systemd/system/multi-user.target.wants/radiusd.service → /usr/lib/systemd/system/radiusd.service.
<strong>
</strong><strong>[root@rocky8 ~]# systemctl status radiusd
</strong>● radiusd.service - FreeRADIUS high performance RADIUS server.
   Loaded: loaded (/usr/lib/systemd/system/radiusd.service; enabled; vendor preset: disabled)
   Active: active (running) since Thu 2022-09-08 11:44:19 +0430; 2s ago
  Process: 863414 ExecStart=/usr/sbin/radiusd -d /etc/raddb (code=exited, status=0/SUCCESS)
  Process: 863411 ExecStartPre=/usr/sbin/radiusd -C (code=exited, status=0/SUCCESS)
  Process: 863372 ExecStartPre=/bin/sh /etc/raddb/certs/bootstrap (code=exited, status=0/SUCCESS)
  Process: 863370 ExecStartPre=/bin/chown -R radiusd.radiusd /var/run/radiusd (code=exited, status=0/SUCCESS)
 Main PID: 863417 (radiusd)
    Tasks: 6 (limit: 12245)
   Memory: 78.6M
   CGroup: /system.slice/radiusd.service
           └─863417 /usr/sbin/radiusd -d /etc/raddb

Sep 08 11:44:18 rocky8 sh[863372]:                   URI:http://www.example.com/example_ca.crl
Sep 08 11:44:18 rocky8 sh[863372]: Certificate is to be certified until Nov  7 07:14:18 2022 GMT (60 days)
Sep 08 11:44:18 rocky8 sh[863372]: Write out database with 1 new entries
Sep 08 11:44:18 rocky8 sh[863372]: Data Base Updated
Sep 08 11:44:18 rocky8 sh[863372]: openssl pkcs12 -export -in client.crt -inkey client.key -out client.p12  -passin pass:'whatever' -passout pass:'w>
Sep 08 11:44:18 rocky8 sh[863372]: chmod g+r client.p12
Sep 08 11:44:18 rocky8 sh[863372]: openssl pkcs12 -in client.p12 -out client.pem -passin pass:'whatever' -passout pass:'whatever'
Sep 08 11:44:18 rocky8 sh[863372]: chmod g+r client.pem
Sep 08 11:44:18 rocky8 sh[863372]: cp client.pem 'user@example.org'.pem
Sep 08 11:44:19 rocky8 systemd[1]: Started FreeRADIUS high performance RADIUS server..
</code></pre>

### /etc/raddb/\*

For every part of FreeRADIUS, in the configuration directory (`/etc/raddb`, `/etc/freeradius` or similar) there is a fully commented example file included, that explains what it does, and how to use it. Read those sample files too!

Again, many of the configuration files are **ONLY** documented in the comments included in the files.

Reading the configuration files is **REQUIRED** to fully understand how to create complex configurations of the server.

#### Main configuration files

* [radiusd.conf](https://github.com/FreeRADIUS/freeradius-server/blob/v3.0.x/raddb/radiusd.conf.in) -- FreeRADIUS server configuration file
* [clients.conf](https://github.com/FreeRADIUS/freeradius-server/blob/v3.0.x/raddb/clients.conf) -- client configuration directives
* [modules configuration](https://wiki.freeradius.org/pages/modules/)&#x20;
* [sites configuration](https://wiki.freeradius.org/config/Sites-configuration)
* [proxy.conf](https://github.com/FreeRADIUS/freeradius-server/blob/v3.0.x/raddb/proxy.conf) -- proxy radius and realm configuration directives
* [policy.d](https://github.com/FreeRADIUS/freeradius-server/tree/v3.0.x/raddb/policy.d) (previously `policy.conf` in v2)

### radmin

radmin - FreeRADIUS Administration tool, is a FreeRADIUS Server administration tool that connects to the control socket of a running server, and gives a command-line interface to it.

At this time, only a few commands are supported. Please type "help" at the command prompt for detailed information about the supported commands.&#x20;

```
radmin [-d config_directory] [-D dictionary_directory] [-e command] [-E] [-f socket_file] [-h] [-i input_file] [-n name] [-q]
```

{% hint style="danger" %}
### WARNING

The security protections offered by this command are limited to the permissions on the Unix domain socket, and the server configuration. If someone can connect to the Unix domain socket, they have a substantial amount of control over the server. &#x20;
{% endhint %}

```
OPTIONS
       The following command-line options are accepted by the program.

       -d config directory
              Defaults to /etc/raddb. radmin looks here for the server configuration files to find the "listen" section that defines the control socket filename.

       -D dictionary directory
              Set main dictionary directory. Defaults to /usr/share/freeradius.

       -e command
              Run command and exit.

       -E     Echo commands as they are being executed.

       -f socket_file
              Specify the socket filename directly.  The radiusd.conf file is not read.

       -h     Print usage help information.

       -i input_file
              Reads input from the specified file.  If not specified, stdin is used.  This also sets "-q".

       -n mname
              Read raddb/name.conf instead of raddb/radiusd.conf.

       -q     Quiet mode.

COMMANDS
       The commands implemented by the command-line interface are almost completely controlled by the server.  There are a few commands interpreted locally by radmin:

       reconnect
              Reconnect to the server.

       quit   Exit from radmin.

       exit   Exit from radmin.

       The other commands are implemented by the server.  Type "help" at the prompt for more information.
```

```
EXAMPLES
       debug file /var/log/radius/bob.log
              Set debug logs to /var/log/radius/bob.log.  There is very little checking of this filename.  Rogue administrators may be able use this command to  over-write  almost  any
              file on the system.  If those administrators have write access to "radius.conf", they can do the same thing without radmin, too.

       debug condition '(User-Name == "bob")'
              Enable  debugging output for all requests that match the condition.  Any "unlang" condition is valid here.  The condition is parsed as a string, so it must be enclosed in
              single or double quotes.  Strings enclosed in double-quotes must have back-slashes and the quotation marks escaped inside of the string.

              Only one debug condition can be active at a time.

       debug condition '((User-Name == "bob") || (Packet-Src-IP-Address == 192.0.2.22))'
              A more complex condition that enables debugging output for requests containing User-Name "bob", or requests that originate from source IP address 192.0.2.22.

       debug condition
              Disable debug conditionals.
```

radmin have a long list of commands, read it man page, this was only a part of that!

Network Utilities



Network Threads

.

.

.

resources:

[https://cloudinfrastructureservices.co.uk/radius-server-linux/](https://cloudinfrastructureservices.co.uk/radius-server-linux/)

[https://documentation.suse.com/sles/15-SP2/html/SLES-all/cha-security-freeradius.html](https://documentation.suse.com/sles/15-SP2/html/SLES-all/cha-security-freeradius.html)

[https://wiki.freeradius.org/config/Configuration-files](https://wiki.freeradius.org/config/Configuration-files)

.

