# 335.2 Penetration Testing

**Weight:** 3

**Description:** Candidates understand the concepts of penetration testing, including an understand of commonly used penetration testing tools. Furthermore, candidates should be able to use nmap to verify the effectiveness of network security measures.



**Key Knowledge Areas:**

* Understand the concepts of penetration testing and ethical hacking
* Understand legal implications of penetration testing
* Understand the phases of penetration tests, such as active and passive information gathering, enumeration, gaining access, privilege escalation, access maintenance, covering tracks
* Understand the architecture and components of Metasploit, including Metasploit module types and how Metasploit integrates various security tools
* Use nmap to scan networks and hosts, including different scan methods, version scans and operating system recognition
* Understand the concepts of Nmap Scripting Engine and execute existing scripts
* Awareness of Kali Linux, Armitage and the Social Engineer Toolkit (SET)

**Partial list of the used files, terms and utilities:**

* nmap

## Penetration test

A penetration test (pen test) is an authorized simulated attack performed on a computer system to evaluate its security. Penetration testers use the same tools, techniques, and processes as attackers to find and demonstrate the business impacts of weaknesses in a system. Penetration tests usually simulate a variety of attacks that could threaten a business. They can examine whether a system is robust enough to withstand attacks from authenticated and unauthenticated positions, as well as a range of system roles. With the right scope, a pen test can dive into any aspect of a system.

### &#x20;Phases of Penetration Testing

Pen testers simulate attacks by motivated adversaries. To do this, they typically follow a plan that includes the following steps:

<figure><img src=".gitbook/assets/pentest-phases.jpg" alt=""><figcaption></figcaption></figure>

* **Reconnaissance.** Gather as much information about the target as possible from public and private sources to inform the attack strategy. Sources include internet searches, domain registration information retrieval, social engineering, nonintrusive network scanning, and sometimes even dumpster diving. This information helps pen testers map out the target’s attack surface and possible vulnerabilities. Reconnaissance can vary with the scope and objectives of the pen test; it can be as simple as making a phone call to walk through the functionality of a system.
* **Scanning.** Pen testers use tools to examine the target website or system for weaknesses, including open services, application security issues, and open source vulnerabilities. Pen testers use a variety of tools based on what they find during reconnaissance and during the test.
* **Gaining access.** Attacker motivations can include stealing, changing, or deleting data; moving funds; or simply damaging a company’s reputation. To perform each test case, pen testers determine the best tools and techniques to gain access to the system, whether through a weakness such as SQL injection or through malware, social engineering, or something else.
* **Maintaining access.** Once pen testers gain access to the target, their simulated attack must stay connected long enough to accomplish their goals of exfiltrating data, modifying it, or abusing functionality. It’s about demonstrating the potential impact.
* **Covering tracks:** The attacker must clear any trace of compromising the victim system, any type of data gathered, log events, in order to remain anonymous.

{% hint style="success" %}
### **The Benefits of Penetration Testing**

There are many benefits to performing penetration testing. Some of the key ones include:

* **Maintaining compliance.** Many organizations must undergo periodic penetration tests to comply with laws and regulations like the Payment Card Industry Data Security Standard (PCI DSS) and the Health Insurance Portability and Accountability Act .
* **Preventing cyberattacks.** One of the main benefits of penetration testing is finding vulnerabilities in systems. These problems can then be addressed before hackers exploit them.
* **Avoiding costly security incidents.** Penetration testing can help improve an organization’s security posture. Performing penetration tests helps organizations save money through making themselves less susceptible to attacks.
* **Keeping cybersecurity professionals up to date.** To be a successful penetration tester, it’s essential to keep up with the latest trends and techniques. Conducting regular penetration tests can also be beneficial for cybersecurity professionals because it requires them to stay current on the latest cyberthreats and defense measures.
{% endhint %}

### Popular Penetration Testing Tools

There are many different penetration testing tools available, and each has its strengths and weaknesses. Some of the most popular include:

* **Nmap.** Nmap is a powerful network scanning tool that can scan for open ports and services. It also includes features for identifying vulnerable applications.
* **Metasploit.** Metasploit is a vulnerability exploitation tool. It includes a library of exploits for a variety of programs and operating systems, as well as a wizard that can assist penetration testers in capitalizing on known vulnerabilities.
* **Wireshark.** Wireshark is a network analysis tool that can capture packet data from a network and decode it into readable form. This can be useful for identifying malicious traffic or sensitive information being transmitted over a network.
* **Burp Suite.** Burp Suite is an all-in-one web application security testing tool. It can scan websites for vulnerabilities, manipulate requests and responses, and intercept traffic between the client and server.

These are just a few of the many penetration testing tools available . As a penetration tester, it’s essential to be familiar with as many of them as possible so that you can choose the right tool for each penetration testing phase.

{% hint style="info" %}
#### Certified Ethical Hacker <a href="#firstheading" id="firstheading"></a>

**Certified Ethical Hacker** (**CEH**) is a qualification given by **EC-Council** and obtained by demonstrating knowledge of assessing the security of computer systems by looking for weaknesses and vulnerabilities in target systems, using the same knowledge and tools as a malicious hacker, but in a lawful and legitimate manner to assess the security posture of a target system. This knowledge is assessed by answering multiple choice questions regarding various ethical hacking techniques and tools.&#x20;
{% endhint %}

### nmap

**Nmap** is Linux command-line tool for network exploration and security auditing. This tool is generally used by hackers and cybersecurity enthusiasts and even by network and system administrators. It is used for the following purposes:&#x20;

* Real time information of a network
* Detailed information of all the IPs activated on your network
* Number of ports open in a network
* Provide the list of live hosts
* Port, OS and Host scanning

{% hint style="danger" %}
Before start scanning please note that Port scanning without authorization is sometimes against the provider's acceptable use policy (AUP).
{% endhint %}

nmap command with no option just prints its long list of switches and options. For our demonstartion we scan scanme.nmap.org :

```
[root@rocky8 ~]# nmap -v scanme.nmap.org

Starting Nmap 7.01 ( https://nmap.org ) at 2018-01-22 03:25 PST
Initiating Ping Scan at 03:25
Scanning scanme.nmap.org (45.33.32.156) [4 ports]
Completed Ping Scan at 03:25, 0.24s elapsed (1 total hosts)
Initiating Parallel DNS resolution of 1 host. at 03:25
Completed Parallel DNS resolution of 1 host. at 03:25, 0.35s elapsed
Initiating SYN Stealth Scan at 03:25
Scanning scanme.nmap.org (45.33.32.156) [1000 ports]
Discovered open port 80/tcp on 45.33.32.156
Discovered open port 22/tcp on 45.33.32.156
Increasing send delay for 45.33.32.156 from 0 to 5 due to 11 out of 24 dropped probes since last increase.
SYN Stealth Scan Timing: About 12.63% done; ETC: 03:29 (0:03:34 remaining)
SYN Stealth Scan Timing: About 14.37% done; ETC: 03:32 (0:06:04 remaining)
Increasing send delay for 45.33.32.156 from 5 to 10 due to 11 out of 11 dropped probes since last increase.
SYN Stealth Scan Timing: About 58.53% done; ETC: 03:28 (0:01:04 remaining)
Completed SYN Stealth Scan at 03:27, 109.38s elapsed (1000 total ports)
Nmap scan report for scanme.nmap.org (45.33.32.156)
Host is up (0.0018s latency).
Other addresses for scanme.nmap.org (not scanned): 2600:3c01::f03c:91ff:fe18:bb2f
Not shown: 987 filtered ports
PORT     STATE  SERVICE
21/tcp   closed ftp
22/tcp   open   ssh
53/tcp   closed domain
80/tcp   open   http
110/tcp  closed pop3
143/tcp  closed imap
443/tcp  closed https
587/tcp  closed submission
993/tcp  closed imaps
995/tcp  closed pop3s
3389/tcp closed ms-wbt-server
8080/tcp closed http-proxy
8291/tcp closed unknown

Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 110.55 seconds
           Raw packets sent: 3033 (133.256KB) | Rcvd: 1500 (60.008KB)
```

The `-v` option enables verbose mode. other examples:

| nmap Target selection     | Description                   |   |
| ------------------------- | ----------------------------- | - |
| nmap 192.168.10.151       | scan a single IP              |   |
| nmap scanme.nmap.org      | scan a host                   |   |
| nmap 192.168.10.150-155   | scan a range of IPs           |   |
| nmap 192.168.10.0/24      | scan a subnet                 |   |
| nmap -iL myserverlist.txt | scan targets from a text file |   |
| nmap -6 \[IP-V6-HERE]     | enables IP v6 scanning        |   |

Scanning ports with nmap:

| nmap port selection          |                                 |   |
| ---------------------------- | ------------------------------- | - |
| nmap -p 22 192.168.10.151    | scan a single port              |   |
| nmap -p 1-100 192.168.10.151 | scan a range of port            |   |
| nmap -F 192.168.10.151       | Fast-scan 100 most common ports |   |
| nmap -p- 192.168.10.151      | scan all 65535 ports            |   |

&#x20;nmap has different techniques for scanning. But before explaining them we review some fundamentals.

### TCP 3-Way Handshake Diagram

Below is a very simplified diagram of the TCP 3-way handshake process. Have a look at the diagram on the right as you examine the list of events on the left

|              Event             |                Diagram               |   |
| :----------------------------: | :----------------------------------: | - |
| ![](.gitbook/assets/image.png) | ![](<.gitbook/assets/image (1).png>) |   |

after this small review we can talk about nmap different methods of scanning:

### nmap scan methods

* **TCP SYN Scan (-sS)**

It is a basic scan, and it is also called half-open scanning because this technique allows Nmap to get information from the remote host without the complete TCP handshake process, Nmap sends SYN packets to the destination, but it does not create any sessions, As a result, the target computer can’t create any log of the interaction because no session was initiated, making this feature an advantage of the TCP SYN scan.`nmap -sT 192.168.10.151`

* **TCP connect() scan (-sT)**

This the default scanning technique used, if and only if the SYN scan is not an option, because the SYN scan requires root privilege. Unlike the TCP SYN scan, it completes the normal TCP three way handshake process and requires the system to call connect(), which is a part of the operating system. Keep in mind that this technique is only applicable to find out the TCP ports, not the UDP ports. `nmap -sT 192.168.10.151`

* **UDP Scan (-sU)**

As the name suggests, this technique is used to find an open UDP port of the target machine. It does not require any SYN packet to be sent because it is targeting the UDP ports. But we can make the scanning more effective by using -sS along with –sU. UDP scans send the UDP packets to the target machine, and waits for a response—if an error message arrives saying the ICMP is unreachable, then it means that the port is closed; but if it gets an appropriate response, then it means that the port is open.

`nmap -sU 192.168.10.151`

* **FIN Scan (-sF)**

Sometimes a normal TCP SYN scan is not the best solution because of the firewall. IDS and IPS scans might be deployed on the target machine, but a firewall will usually block the SYN packets. A FIN scan sends the packet only set with a FIN flag, so it is not required to complete the TCP handshaking.

The target computer is not able to create a log of this scan (again, an advantage of FIN). Just like a FIN scan, we can perform an xmas scan (-sX) and Null scan (-sN). The idea is same but there is a difference between each type of scan.

* **Ping Scan (-sP)**

Ping scanning is unlike the other scan techniques because it is only used to find out whether the host is alive or not, it is not used to discover open ports. Ping scans require root access s ICMP packets can be sent, but if the user does not have administrator privilege, then the ping scan uses connect() call. `nmap -sP 192.168.10.151`

* **Version Detection (-sV)**

Version detection is the right technique that is used to find out what software version is running on the target computer and on the respective ports. It is unlike the other scanning techniques because it is not used to detect the open ports, but it requires the information from open ports to detect the software version. In the first step of this scan technique, version detection uses the TCP SYN scan to find out which ports are open. **** `nmap -sV 192.168.10.151`

* **Idle Scan (-sI)**

Idle scan is one of my favorite techniques, and it is an advance scan that provides complete anonymity while scanning. In idle scan, Nmap doesn’t send the packets from your real IP address—instead of generating the packets from the attacker machine, Nmap uses another host from the target network to send the packets. ex: **** `nmap -sI 192.168.1.6 192.168.1.1`

The idle scan technique (as mentioned above) is used to discover the open ports on 192.168.1.1 while it uses the zombie\_host (192.168.1.6) to communicate with the target host. So this is an ideal technique to scan a target computer anonymously.

### Nmap Scripting Engine (NSE)



####

####





.

.

.

resources:

[https://www.synopsys.com/glossary/what-is-penetration-testing.html](https://www.synopsys.com/glossary/what-is-penetration-testing.html)

[https://www.eccouncil.org/cybersecurity-exchange/penetration-testing/penetration-testing-phases/#:\~:text=There%20are%20five%20penetration%20testing,assessment%2C%20exploitation%2C%20and%20reporting.](https://www.eccouncil.org/cybersecurity-exchange/penetration-testing/penetration-testing-phases/)

[https://www.synopsys.com/glossary/what-is-penetration-testing.html](https://www.synopsys.com/glossary/what-is-penetration-testing.html)

[https://en.wikipedia.org/wiki/Penetration\_test](https://en.wikipedia.org/wiki/Penetration\_test)

[https://en.wikipedia.org/wiki/Certified\_Ethical\_Hacker](https://en.wikipedia.org/wiki/Certified\_Ethical\_Hacker)

[https://www.geeksforgeeks.org/nmap-command-in-linux-with-examples/](https://www.geeksforgeeks.org/nmap-command-in-linux-with-examples/)

[https://www.linux.org/threads/nmap-installation.4473/](https://www.linux.org/threads/nmap-installation.4473/)

[https://www.linux.org/threads/nmap-common-scans-%E2%80%93-part-one.4476/](https://www.linux.org/threads/nmap-common-scans-%E2%80%93-part-one.4476/)

[https://www.linux.org/threads/nmap-common-scans-%E2%80%93-part-two.4483/](https://www.linux.org/threads/nmap-common-scans-%E2%80%93-part-two.4483/)

.



