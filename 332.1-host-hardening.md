# 332.1 Host Hardening

#### _Topic 332: Host Security_

**Weight:** 5

**Description:** Candidates should be able to secure computers running Linux against common threats.



**Key Knowledge Areas:**

* Configure BIOS and boot loader (GRUB 2) security
* Disable unused software and services
* Understand and drop unnecessary capabilities for specific systemd units and the entire system
* Understand and configure Address Space Layout Randomization (ASLR), Data Execution Prevention (DEP) and Exec-Shield
* Black and white list USB devices attached to a computer using USBGuard
* Create an SSH CA, create SSH certificates for host and user keys using the CA and configure OpenSSH to use SSH certificates
* Work with chroot environments
* Use systemd units to limit the system calls and capabilities available to a process
* Use systemd units to start processes with limited or no access to specific files and devices
* Use systemd units to start processes with dedicated temporary and /dev directories and without network access
* Understand the implications of Linux Meltdown and Spectre mitigations and enable/disable the mitigations
* Awareness of polkit
* Awareness of the security advantages of virtualization and containerization

**The following is a partial list of the used files, terms and utilities:**

* grub.cfg
* systemctl
* getcap
* setcap
* capsh
* sysctl
* /etc/sysctl.conf
* /etc/usbguard/usbguard-daemon.conf
* /etc/usbguard/rules.conf
* usbguard
* ssh-keygen
* /etc/ssh/
* \~/.ssh/
* /etc/ssh/sshd\_config
* chroot



## Kernel Security

#### &#x20;Disabling unnecessary software:&#x20;

• Every running program presents a possible security threat.&#x20;

• Disabling unused services is a good security practice.&#x20;

• Use systemctl and chkconfig to disable services.&#x20;

• Commonly disabled services include atd, ava hi-daemon, cups.

#### &#x20;Limiting resource usage:&#x20;

• The user may limit system resources such as threads, open files, and memory.&#x20;

• The **paml\_limits.so** module allows operators to control how much of any one resource a user may access through hard and soft limits.

• Most systems come with pam.so preloaded.&#x20;

• The ulimit command may be used to adjust these limits at runtime.&#x20;

{% hint style="success" %}
visit my LPIC1: [https://borosan.gitbook.io/lpic1-exam-guide/1101-perform-security-administration-tasks#ulimit](https://borosan.gitbook.io/lpic1-exam-guide/1101-perform-security-administration-tasks#ulimit)
{% endhint %}

• Limits may be set persistently in /etc/security/limits.conf.&#x20;

#### Tuning kernel parameters:&#x20;

• The sysctl command is capable of displaying and setting kernel parameters.

```
[root@rocky8 ~]# sysctl -a | less
[root@rocky8 ~]# sysctl -ar icmp
net.ipv4.icmp_echo_ignore_all = 0
net.ipv4.icmp_echo_ignore_broadcasts = 1
net.ipv4.icmp_errors_use_inbound_ifaddr = 0
net.ipv4.icmp_ignore_bogus_error_responses = 1
net.ipv4.icmp_msgs_burst = 50
net.ipv4.icmp_msgs_per_sec = 1000
net.ipv4.icmp_ratelimit = 1000
net.ipv4.icmp_ratemask = 6168
net.ipv6.icmp.ratelimit = 1000
net.netfilter.nf_conntrack_icmp_timeout = 30
net.netfilter.nf_conntrack_icmpv6_timeout = 30
```

{% hint style="info" %}
**Sysctl Review**&#x20;

**View Settings:**&#x20;

sysctl -a&#x20;

sysctl -ar \<search\_pattern>&#x20;

procfs&#x20;

**Setting parameters:**&#x20;

sysctl -w  \<param>=\<value>

**Persist changes:**&#x20;

etc/sysctl.conf
{% endhint %}

{% hint style="success" %}
for full review visit my LPIC2 book: [https://borosan.gitbook.io/lpic2-exam-guide/2042-adjusting-storage-device-access#sysctl](https://borosan.gitbook.io/lpic2-exam-guide/2042-adjusting-storage-device-access#sysctl)
{% endhint %}

• Parameters map to the procfs filesystem.&#x20;

```
[root@rocky8 ~]# ls -l  /proc/sys
total 0
dr-xr-xr-x. 1 root root 0 Sep  6 07:57 abi
dr-xr-xr-x. 1 root root 0 Sep  6 04:41 crypto
dr-xr-xr-x. 1 root root 0 Sep  6 07:57 debug
dr-xr-xr-x. 1 root root 0 Sep  6 07:57 dev
dr-xr-xr-x. 1 root root 0 Apr  4 16:17 fs
dr-xr-xr-x. 1 root root 0 Apr  4 16:17 kernel
dr-xr-xr-x. 1 root root 0 Sep  6 05:46 net
dr-xr-xr-x. 1 root root 0 Sep  6 07:57 user
dr-xr-xr-x. 1 root root 0 Sep  6 07:57 vm

[root@rocky8 ~]# ll /proc/sys/net/ipv4/icmp*
-rw-r--r--. 1 root root 0 Sep  6 08:05 /proc/sys/net/ipv4/icmp_echo_ignore_all
-rw-r--r--. 1 root root 0 Sep  6 07:57 /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts
-rw-r--r--. 1 root root 0 Sep  6 07:57 /proc/sys/net/ipv4/icmp_errors_use_inbound_ifaddr
-rw-r--r--. 1 root root 0 Sep  6 07:57 /proc/sys/net/ipv4/icmp_ignore_bogus_error_responses
-rw-r--r--. 1 root root 0 Sep  6 07:57 /proc/sys/net/ipv4/icmp_msgs_burst
-rw-r--r--. 1 root root 0 Sep  6 07:57 /proc/sys/net/ipv4/icmp_msgs_per_sec
-rw-r--r--. 1 root root 0 Sep  6 07:57 /proc/sys/net/ipv4/icmp_ratelimit
-rw-r--r--. 1 root root 0 Sep  6 07:57 /proc/sys/net/ipv4/icmp_ratemask

```

{% hint style="success" %}
visit my LPIC1 book: [https://borosan.gitbook.io/lpic1-exam-guide/1011-determine-and-configure-hardware-settings#proc](https://borosan.gitbook.io/lpic1-exam-guide/1011-determine-and-configure-hardware-settings#proc)
{% endhint %}

• Kernel parameters set persistently in the file /etc/sysctl.conf.&#x20;

> See kernel-docs for additional information.

{% hint style="danger" %}
in modern linux distributions, the location of configs might be different:

\[root@rocky8 \~]# cat /etc/sysctl.conf sysctl settings are defined through files in /usr/lib/sysctl.d/, /run/sysctl.d/, and /etc/sysctl.d/.

Vendors settings live in /usr/lib/sysctl.d/. To override a whole file, create a new file with the same in /etc/sysctl.d/ and put new settings there. To override only specific settings, add a file with a lexically later name in /etc/sysctl.d/ and put new settings there.

For more information, see sysctl.conf(5) and sysctl.d(5).
{% endhint %}

#### Managing ASLR:&#x20;

• ASLR stands for Address Space Layout Randomization.&#x20;

• It ensures that every time a program loads, it loads into a different place in memory.

#### The NX bit:&#x20;

• The NX bit is a CPU feature.&#x20;

• It prevents execution from protected memory areas.&#x20;

• Exec-Shield is a software solution for the same problem designed to support CPUs without this feature.

#### ICMP security settings:

&#x20;• Network security may be enhanced through kernel parameter tuning.&#x20;

• Disabling ICMP is a common security measure that may be achieved by setting the parameter net.ipv4.icmp\_echo\_ignore\_all to 1.

```
[root@rocky8 ~]# sysctl -w net.ipv4.icmp_echo_ignore_all=1
net.ipv4.icmp_echo_ignore_all = 1
```

#### Chroot Environments&#x20;

• A chroot environment is a ‘fake root’ that is set for a specific user and process.&#x20;

• The chroot command is used by root to create the environment using a pre-configured area in the filesystem.&#x20;

• An unprivileged process is unable to access files outside of a chroot environment.&#x20;

• Be mindful of hard links in chroot environments.they can get out!

#### Virtualization&#x20;

• Virtualization is similar to a chroot environment but at a much more advanced level.&#x20;

• Containerization is similar in nature when it comes to resource segmentation and process isolation.



## Securing Grub
