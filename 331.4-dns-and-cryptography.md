# 331.4 DNS and Cryptography

**Weight:** 5

**Description:** Candidates should have experience and knowledge of cryptography in the context of DNS and its implementation using BIND. The version of BIND covered is 9.7 or higher.



**Key Knowledge Areas:**

* Understand the concepts of DNS, zones and resource records
* Understand DNSSEC, including key signing keys, zone signing keys and relevant DNS records such as DS, DNSKEY, RRSIG, NSEC, NSEC3

and NSEC3PARAM

* Configure and troubleshoot BIND as an authoritative name server serving DNSSEC secured zones
* Manage DNSSEC signed zones, including key generation, key rollover and re-signing of zones
* Configure BIND as an recursive name server that performs DNSSEC validation on behalf of its clients
* Understand CAA and DANE, including relevant DNS records such as CAA and TLSA
* Use CAA and DANE to publish X.509 certificate and certificate authority information in DNS
* Use TSIG for secure communication with BIND
* Awareness of DNS over TLS and DNS over HTTPS
* Awareness of Multicast DNS

**Partial list of the used files, terms and utilities:**

* named.conf
* dnssec-keygen
* dnssec-signzone
* dnssec-settime
* dnssec-dsfromkey
* rndc (including relevant subcommands)
* dig
* delv
* openssl (including relevant subcommands)

## Working with DNS

### DNS overview

DNS is a hierarchical distributed database that stores IP addresses and other data and allows queries by name.

#### DNS server types <a href="#dns_server_types" id="dns_server_types"></a>

A DNS server stores a database of domain names, and then processes domain names based on DNS queries that come from a client in a network.

* **Authoritative server** An authoritative server is a server that holds the DNS name records, including A, AAAA, and CNAME.
* **A non-authoritative** server constructs a cache file based on previous queries for domains. It does not hold original name records.

#### Recursive resolver ,  iterative resolver <a href="#recursive_resolver" id="recursive_resolver"></a>

A _recursive resolver_ is the server that sends a query to the authoritative or non-authoritative server for resolution. A recursive resolver is so-called because it performs each query for a given name and returns the final result.

This is in contrast to an _iterative resolver_, which only returns a referral to the next DNS servers that might have the answer.

#### Zones <a href="#zones" id="zones"></a>

* **Public zone :** A public zone is visible to the internet. You can create DNS records in a public zone to publish your service on the internet. For example, you might create an A record in a public zone called `example.com.` (note the trailing dot) for your public website `www.example.com.`.
* **Private zone :** A private zone is any zone that cannot be queried over the public internet.
* **Delegated subzone:** DNS allows the owner of a zone to use NS records to delegate a subdomain to a different name server. Resolvers follow these records and send queries for the subdomain to the target name server specified in the delegation. For example, you can create separate zones for both `example.com` and `subdomain.example.com`, each with its own authoritative name server. Because `subdomain.example.com` is a child domain of `example.com`, the method to enable the authoritative name server for the subdomain to be located from the parent domain's zone is called delegation. Delegation is essentially a pointer to the authoritative name server for a subdomain. To enable delegation in Cloud DNS, you can add NS records for the subdomains in the zone of the parent domain.

#### Split horizon DNS <a href="#split_horizon_dns" id="split_horizon_dns"></a>

Split horizon is a term used to describe an instance when two zones, one to be used by the internal network and the other to be used by the external network (usually the internet), are created for the same domain. Split-horizon DNS lets you serve different answers (different resource record sets) for the same name depending on who is asking.

For example, you can provide the development/staging version of your app if the query comes from the development network, and the production/public version of your app if the query comes from the public internet.

#### Records <a href="#records" id="records"></a>

A record is a mapping between a DNS resource and a domain name. Each individual DNS record has a type (name and number), an expiration time (time to live), and type-specific data.

Some of the commonly used record types are:

* **A:** Address record, which maps host names to their IPv4 address.
* **AAAA:** IPv6 Address record, which maps host names to their IPv6 address.
* **CNAME:** Canonical name record, which specifies alias names.
* **MX:** Mail exchange record, which is used in routing requests to mail servers.
* **NS:** Name server record, which delegates a DNS zone to an authoritative server.
* **PTR:** Pointer record, which defines a name associated with an IP address.
* **SOA:** Start of authority, used to designate the primary name server and administrator responsible for a zone. Each zone hosted on a DNS server must have an SOA (start of authority) record. You can modify the record as needed (for example, you can change the serial number to an arbitrary number to support date-based versioning).

#### Record sets <a href="#record_sets" id="record_sets"></a>

Records with the same name and of the same type but with different data values are called record sets. When you create a record, if a set with the same name and type exists, the record is added to this matching set. If there's no matching set, a new set is created and appended to the list of record sets.

This is an example of a record set with more than one record having the same name and type:

| DNS name                    | Type | TTL (seconds) | Data          |
| --------------------------- | ---- | ------------- | ------------- |
| `db-01.dev.gcp.example.com` | A    | 50            | `10.128.1.35` |
| `db-01.dev.gcp.example.com` | A    | 50            | `10.128.1.10` |

{% hint style="danger" %}
### Delegation of subdomains <a href="#delegation_of_subdomains" id="delegation_of_subdomains"></a>

When creating records, make sure that the NS and SOA records match each other. Conflicting NS and SOA records can cause some resolvers to reject the delegation as invalid and refuse to cache `NO DATA` responses to queries. This can result in a large unexpected number of queries against your public managed zones by third-party recursive resolvers when resolvers query your public managed zones for records that do not exist.
{% endhint %}

### Registrar <a href="#registrar" id="registrar"></a>

A domain name registrar is an organization that manages the reservation of internet domain names for public zones. A registrar must be accredited by a generic top-level domain (gTLD) registry or a country code top-level domain (ccTLD) registry. This is how _upper-level_ name servers agree on SOA and update NS records for the zone to direct requests to caching or authoritative name servers.

### SOA serial number <a href="#soa_serial_number" id="soa_serial_number"></a>

The SOA serial number is a version number for a DNS zone. For all name servers to be current with the version of a zone, they must have the same SOA serial number. The serial numbers of SOA records created in DNS managed zones [monotonically](https://wikipedia.org/wiki/Monotonic\_function) increase with each transactional change to a zone's record sets.

However, you can change the serial number of an SOA record to an arbitrary number, including an ISO 8601-formatted date, as recommended in [RFC 1912](https://tools.ietf.org/html/rfc1912).

## Securing DNS with DNSSEC

### DNSSEC <a href="#dnssec" id="dnssec"></a>

The Domain Name System Security Extension (DNSSEC) addresses vulnerabilities to DNS data. DNSSEC is a suite of IETF specifications that provides authentication of DNS data, authenticated denial of existence, and data integrity to DNS clients (resolvers). In short, DNSSEC provides a way for software to verify the origin of DNS data and validate that it has not been modified in transit.

.

.

.

reources:

[https://cloud.google.com/dns/docs/dns-overview#:\~:text=DNS%20is%20a%20hierarchical%20distributed,to%20communicate%20with%20each%20other.](https://cloud.google.com/dns/docs/dns-overview)

.
